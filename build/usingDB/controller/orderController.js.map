{"version":3,"sources":["../../../SERVER/usingDB/controller/orderController.js"],"names":["Order","create","req","res","text","body","amount","price_offered","values","car_id","buyer","price","status","Date","send","error","db","query","rows","data","getUpdateOrderPrice","findOneQuery","updateOneQuery","params","id","orderId","old_price_offered","new_price_offered","response"],"mappings":"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","sourcesContent":["\r\nimport '@babel/polyfill';\r\nimport moment from 'moment';\r\nimport uuidv4 from 'uuid/v4';\r\nimport db from '../db';\r\n\r\nconst Order = {\r\n\r\n  /**\r\n   * Create A Order\r\n   * @param {object} req\r\n   * @param {object} res\r\n   * @returns {object} order object\r\n   */\r\n  async create(req, res) {\r\n    const text = `INSERT INTO\r\n      orders(id, car_id, buyer, price, price_offered, status, created_on, modified_date)\r\n      VALUES($1, $2, $3, $4, $5, $6, $7, $8)\r\n      returning *`;\r\n    if (req.body.amount) {\r\n      req.body.price_offered = req.body.amount;\r\n    }\r\n    const values = [\r\n      uuidv4(),\r\n      req.body.car_id,\r\n      req.body.buyer,\r\n      req.body.price,\r\n      req.body.price_offered,\r\n      req.body.status,\r\n      moment(new Date()),\r\n      moment(new Date()),\r\n    ];\r\n    try {\r\n      // handling no input for creating a purchase order\r\n      if (!req.body.price_offered || !req.body.car_id) {\r\n        return res.status(400).send({ status: 400, error: 'please enter price offered and car ID' });\r\n      }\r\n      const { rows } = await db.query(text, values);\r\n      const data = (rows[0]);\r\n      return res.status(201).send({ status: 201, data });\r\n    } catch (error) {\r\n      return res.status(400).send({ status: 400, error });\r\n    }\r\n  },\r\n  /**\r\n   * Update price of an Order\r\n   * @param {object} req\r\n   * @param {object} res\r\n   * @returns {object} updated order\r\n   */\r\n  async getUpdateOrderPrice(req, res) {\r\n    const findOneQuery = 'SELECT * FROM orders WHERE id=$1';\r\n\r\n    const updateOneQuery = `UPDATE orders\r\n      SET car_id=$1,price=$2,price_offered=$3, old_price_offered=$4, new_price_offered=$5, modified_date=$6\r\n      WHERE id=$7 returning *`;\r\n    try {\r\n      // req.body.new_price_offered = req.body.price;\r\n      if (!req.body.price) {\r\n        return res.status(400).send({ status: 400, error: 'please enter new price offered and car ID' });\r\n      }\r\n      req.params.id = req.params.orderId;\r\n      const { rows } = await db.query(findOneQuery, [req.params.id]);\r\n\r\n      req.body.old_price_offered = rows[0].price_offered;\r\n      if (!req.body.amount) {\r\n        req.body.new_price_offered = req.body.price;\r\n      } else {\r\n        req.body.new_price_offered = req.body.amount;\r\n      }\r\n\r\n      const values = [\r\n        req.body.car_id,\r\n        req.body.price,\r\n        req.body.price_offered,\r\n        req.body.old_price_offered,\r\n        req.body.new_price_offered,\r\n        moment(new Date()),\r\n        req.params.id,\r\n\r\n      ];\r\n      const response = await db.query(updateOneQuery, values);\r\n      const data = response.rows[0];\r\n      return res.status(200).send({ status: 200, data });\r\n    } catch (err) {\r\n      return res.status(400).send(err);\r\n    }\r\n  },\r\n};\r\n\r\nexport default Order;\r\n"],"file":"orderController.js"}